!function(){"use strict";function m(t){var n=t;return{get:function(){return n},set:function(t){n=t}}}function i(t){return function(){return t}}function t(){return f}var u,n=tinymce.util.Tools.resolve("tinymce.PluginManager"),r=function(){return(r=Object.assign||function(t){for(var n,e=1,r=arguments.length;e<r;e++)for(var o in n=arguments[e])Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o]);return t}).apply(this,arguments)},a=Object.prototype.hasOwnProperty,l=(u=function(t,n){return n},function(){for(var t=new Array(arguments.length),n=0;n<t.length;n++)t[n]=arguments[n];if(0===t.length)throw new Error("Can't merge zero objects");for(var e={},r=0;r<t.length;r++){var o,i=t[r];for(o in i)a.call(i,o)&&(e[o]=u(e[o],i[o]))}return e}),c=i(!1),s=i(!0),f={fold:function(t,n){return t()},is:c,isSome:c,isNone:s,getOr:g,getOrThunk:o,getOrDie:function(t){throw new Error(t||"error: getOrDie called on none.")},getOrNull:i(null),getOrUndefined:i(void 0),or:g,orThunk:o,map:t,each:function(){},bind:t,exists:c,forall:s,filter:t,equals:e,equals_:e,toArray:function(){return[]},toString:i("none()")};function e(t){return t.isNone()}function o(t){return t()}function g(t){return t}function d(t,n){for(var e=k(t),r=0,o=e.length;r<o;r++){var i=e[r];n(t[i],i)}}function h(t,n){return-1!==t.indexOf(n)}function y(t,n){return A.call(t,n)?t[n]:n}function v(t){var e,t=t.getParam("emoticons_append",{},"object");return e=function(t){return r({keywords:[],category:"user"},t)},_(t,function(t,n){return{k:n,v:e(t,n)}})}function p(e,o,t){function r(t){var i={},u=[];d(t,function(t,n){var e,r,o,e={title:n,keywords:t.keywords,char:(r=(e=t).char,o=r,r=0,""===(n=n="<img")||o.length>=n.length&&o.substr(r,r+n.length)===n?e.char.replace(/src="([^"]+)"/,function(t,n){return'src="'+c+n+'"'}):e.char),category:y(L,t.category)},t=void 0!==i[e.category]?i[e.category]:[];i[e.category]=t.concat([e]),u.push(e)}),a.set(j.some(i)),n.set(j.some(u))}var a=m(j.none()),n=m(j.none()),c=e.getParam("emoticons_images_url","https://twemoji.maxcdn.com/v/13.0.1/72x72/","string");e.on("init",function(){T.load(t,o).then(function(t){var n=v(e);r(l(t,n))},function(t){console.log("Failed to load emoticons: "+t),a.set(j.some({})),n.set(j.some([]))})});var i=function(){return n.get().getOr([])},u=function(){return a.get().isSome()&&n.get().isSome()};return{listCategories:function(){return[D].concat(k(a.get().getOr({})))},hasLoaded:u,waitForLoad:function(){return u()?x.resolve(!0):new x(function(t,n){var e=15,r=P.setInterval(function(){u()?(P.clearInterval(r),t(!0)):--e<0&&(console.log("Could not load emojis from url: "+o),P.clearInterval(r),n(!1))},100)})},listAll:i,listCategory:function(n){return n===D?i():a.get().bind(function(t){return j.from(t[n])}).getOr([])}}}function b(t){t.on("PreInit",function(){t.parser.addAttributeFilter("data-emoticon",function(t){!function(t,n){for(var e=0,r=t.length;e<r;e++)n(t[e],e)}(t,function(t){t.attr("data-mce-resize","false"),t.attr("data-mce-placeholder","1")})})})}function w(t,n,e){for(var r=[],o=n.toLowerCase(),i=e.fold(function(){return c},function(n){return function(t){return n<=t}}),u=0;u<t.length&&(0!==n.length&&!function(t,n){return h(t.title.toLowerCase(),n)||function(t,n){for(var e=0,r=t.length;e<r;e++)if(n(t[e],e))return!0;return!1}(t.keywords,function(t){return h(t.toLowerCase(),n)})}(t[u],o)||(r.push({value:t[u].char,text:t[u].title,icon:t[u].char}),!i(r.length)));u++);return r}function O(e,o){function t(){return{title:"Emoticons",size:"normal",body:{type:"tabpanel",tabs:function(t,n){for(var e=t.length,r=new Array(e),o=0;o<e;o++){var i=t[o];r[o]=n(i,o)}return r}(o.listCategories(),function(t){return{title:t,name:t,items:[l,s]}})},initialData:n,onTabChange:function(t,n){a.set(n.newTabName),c.throttle(t)},onChange:c.throttle,onAction:function(t,n){"results"===n.name&&(n=n.value,e.insertContent(n),t.close())},buttons:[{type:"cancel",text:"Close",primary:!0}]}}var r,i,u,n={pattern:"",results:w(o.listAll(),"",j.some(300))},a=m(D),c=(r=function(t){var n,e,r;e=(n=t).getData(),r=a.get(),t=o.listCategory(r),r=w(t,e[S],r===D?j.some(300):j.none()),n.setData({results:r})},i=200,u=null,{cancel:function(){null!==u&&(clearTimeout(u),u=null)},throttle:function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];null!==u&&clearTimeout(u),u=setTimeout(function(){r.apply(null,t),u=null},i)}}),l={label:"Search",type:"input",name:S},s={type:"collection",name:"results"},f=e.windowManager.open(t());f.focus(S),o.hasLoaded()||(f.block("Loading emoticons..."),o.waitForLoad().then(function(){f.redial(t()),c.throttle(f),f.focus(S),f.unblock()}).catch(function(t){f.redial({title:"Emoticons",body:{type:"panel",items:[{type:"alertbanner",level:"error",icon:"warning",text:"<p>Could not load emoticons</p>"}]},buttons:[{type:"cancel",text:"Close",primary:!0}],initialData:{pattern:"",results:[]}}),f.focus(S),f.unblock()}))}var C=function(e){function t(){return o}function n(t){return t(e)}var r=i(e),o={fold:function(t,n){return n(e)},is:function(t){return e===t},isSome:s,isNone:c,getOr:r,getOrThunk:r,getOrDie:r,getOrNull:r,getOrUndefined:r,or:t,orThunk:t,map:function(t){return C(t(e))},each:function(t){t(e)},bind:n,exists:n,forall:n,filter:function(t){return t(e)?o:f},toArray:function(){return[e]},toString:function(){return"some("+e+")"},equals:function(t){return t.is(e)},equals_:function(t,n){return t.fold(c,function(t){return n(e,t)})}};return o},j={some:C,none:t,from:function(t){return null==t?f:C(t)}},k=Object.keys,A=Object.hasOwnProperty,_=function(t,e){var r={};return d(t,function(t,n){n=e(t,n);r[n.k]=n.v}),r},T=tinymce.util.Tools.resolve("tinymce.Resource"),P=tinymce.util.Tools.resolve("tinymce.util.Delay"),x=tinymce.util.Tools.resolve("tinymce.util.Promise"),D="All",L={symbols:"Symbols",people:"People",animals_and_nature:"Animals and Nature",food_and_drink:"Food and Drink",activity:"Activity",travel_and_places:"Travel and Places",objects:"Objects",flags:"Flags",user:"User Defined"},S="pattern";n.add("emoticons",function(t,n){var e,r,o,i,u,n=(e=n,n=(a=t).getParam("emoticons_database","emojis","string"),a.getParam("emoticons_database_url",e+"/js/"+n+a.suffix+".js","string")),a=t.getParam("emoticons_database_id","tinymce.plugins.emoticons","string"),a=p(t,n,a);function c(){return O(r,o)}o=a,(r=t).ui.registry.addButton("emoticons",{tooltip:"Emoticons",icon:"emoji",onAction:c}),r.ui.registry.addMenuItem("emoticons",{text:"Emoticons...",icon:"emoji",onAction:c}),u=a,(i=t).ui.registry.addAutocompleter("emoticons",{ch:":",columns:"auto",minChars:2,fetch:function(n,e){return u.waitForLoad().then(function(){var t=u.listAll();return w(t,n,j.some(e))})},onAction:function(t,n,e){i.selection.setRng(n),i.insertContent(e),t.hide()}}),b(t)})}();