!function(){"use strict";function f(t){var n=t;return{get:function(){return n},set:function(t){n=t}}}function i(t){return function(){return t}}function t(){return c}function l(t,n){for(var e=O(t),o=0,r=e.length;o<r;o++){var i=e[o];n(t[i],i)}}function s(t,n){return-1!==t.indexOf(n)}function m(t){var e,o,t=t.getParam("emoticons_append",{},"object"),r=function(t){return a({keywords:[],category:"user"},t)};return e=function(t,n){return{k:n,v:r(t)}},o={},l(t,function(t,n){n=e(t,n);o[n.k]=n.v}),o}function g(e,r,t){function o(t){var r={},i=[];l(t,function(t,n){var e,o,o={title:n,keywords:t.keywords,char:(e=(o=t).char).length>=(n="<img").length&&e.substr(0,0+n.length)===n?o.char.replace(/src="([^"]+)"/,function(t,n){return'src="'+u+n+'"'}):o.char,category:(o=T,t=t.category,C.call(o,t)?o[t]:t)},t=void 0!==r[o.category]?r[o.category]:[];r[o.category]=t.concat([o]),i.push(o)}),a.set(w.some(r)),n.set(w.some(i))}var a=f(w.none()),n=f(w.none()),u=e.getParam("emoticons_images_url","https://twemoji.maxcdn.com/v/13.0.1/72x72/","string");function i(){return n.get().getOr([])}function c(){return a.get().isSome()&&n.get().isSome()}return e.on("init",function(){j.load(t,r).then(function(t){var n=m(e);o(function(){for(var t=new Array(arguments.length),n=0;n<t.length;n++)t[n]=arguments[n];if(0===t.length)throw new Error("Can't merge zero objects");for(var e={},o=0;o<t.length;o++){var r,i=t[o];for(r in i)p.call(i,r)&&(e[r]=y(e[r],i[r]))}return e}(t,n))},function(t){console.log("Failed to load emoticons: "+t),a.set(w.some({})),n.set(w.some([]))})}),{listCategories:function(){return[_].concat(O(a.get().getOr({})))},hasLoaded:c,waitForLoad:function(){return c()?A.resolve(!0):new A(function(t,n){var e=15,o=k.setInterval(function(){c()?(k.clearInterval(o),t(!0)):--e<0&&(console.log("Could not load emojis from url: "+r),k.clearInterval(o),n(!1))},100)})},listAll:i,listCategory:function(n){return n===_?i():a.get().bind(function(t){return w.from(t[n])}).getOr([])}}}function d(t,n,e){for(var o,r,i=[],a=n.toLowerCase(),u=e.fold(function(){return v},function(n){return function(t){return n<=t}}),c=0;c<t.length&&(0!==n.length&&(o=t[c],r=a,!s(o.title.toLowerCase(),r)&&!function(t){for(var n,e=0,o=t.length;e<o;e++)if(n=t[e],s(n.toLowerCase(),r))return 1}(o.keywords))||(i.push({value:t[c].char,text:t[c].title,icon:t[c].char}),!u(i.length)));c++);return i}function h(e,r){function t(){return{title:"Emoticons",size:"normal",body:{type:"tabpanel",tabs:function(t){for(var n=t.length,e=new Array(n),o=0;o<n;o++){var r=t[o];e[o]={title:r,name:r,items:[c,l]}}return e}(r.listCategories())},initialData:n,onTabChange:function(t,n){a.set(n.newTabName),u.throttle(t)},onChange:u.throttle,onAction:function(t,n){"results"===n.name&&(n=n.value,e.insertContent(n),t.close())},buttons:[{type:"cancel",text:"Close",primary:!0}]}}var o,i,n={pattern:"",results:d(r.listAll(),"",w.some(300))},a=f(_),u=(o=function(t){var n,e=(n=t).getData(),o=a.get(),t=r.listCategory(o),o=d(t,e[P],o===_?w.some(300):w.none());n.setData({results:o})},i=null,{cancel:function(){null!==i&&(clearTimeout(i),i=null)},throttle:function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];null!==i&&clearTimeout(i),i=setTimeout(function(){o.apply(null,t),i=null},200)}}),c={label:"Search",type:"input",name:P},l={type:"collection",name:"results"},s=e.windowManager.open(t());s.focus(P),r.hasLoaded()||(s.block("Loading emoticons..."),r.waitForLoad().then(function(){s.redial(t()),u.throttle(s),s.focus(P),s.unblock()}).catch(function(t){s.redial({title:"Emoticons",body:{type:"panel",items:[{type:"alertbanner",level:"error",icon:"warning",text:"<p>Could not load emoticons</p>"}]},buttons:[{type:"cancel",text:"Close",primary:!0}],initialData:{pattern:"",results:[]}}),s.focus(P),s.unblock()}))}var y,n,e,o=tinymce.util.Tools.resolve("tinymce.PluginManager"),a=function(){return(a=Object.assign||function(t){for(var n,e=1,o=arguments.length;e<o;e++)for(var r in n=arguments[e])Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r]);return t}).apply(this,arguments)},p=Object.prototype.hasOwnProperty,v=i(!(y=function(t,n){return n})),u=i(!0),c={fold:function(t,n){return t()},is:v,isSome:v,isNone:u,getOr:e=function(t){return t},getOrThunk:n=function(t){return t()},getOrDie:function(t){throw new Error(t||"error: getOrDie called on none.")},getOrNull:i(null),getOrUndefined:i(void 0),or:e,orThunk:n,map:t,each:function(){},bind:t,exists:v,forall:u,filter:t,equals:n=function(t){return t.isNone()},equals_:n,toArray:function(){return[]},toString:i("none()")},b=function(e){function t(){return r}function n(t){return t(e)}var o=i(e),r={fold:function(t,n){return n(e)},is:function(t){return e===t},isSome:u,isNone:v,getOr:o,getOrThunk:o,getOrDie:o,getOrNull:o,getOrUndefined:o,or:t,orThunk:t,map:function(t){return b(t(e))},each:function(t){t(e)},bind:n,exists:n,forall:n,filter:function(t){return t(e)?r:c},toArray:function(){return[e]},toString:function(){return"some("+e+")"},equals:function(t){return t.is(e)},equals_:function(t,n){return t.fold(v,function(t){return n(e,t)})}};return r},w={some:b,none:t,from:function(t){return null==t?c:b(t)}},O=Object.keys,C=Object.hasOwnProperty,j=tinymce.util.Tools.resolve("tinymce.Resource"),k=tinymce.util.Tools.resolve("tinymce.util.Delay"),A=tinymce.util.Tools.resolve("tinymce.util.Promise"),_="All",T={symbols:"Symbols",people:"People",animals_and_nature:"Animals and Nature",food_and_drink:"Food and Drink",activity:"Activity",travel_and_places:"Travel and Places",objects:"Objects",flags:"Flags",user:"User Defined"},P="pattern";o.add("emoticons",function(t,n){var e,o,r,i,a,n=(e=n,n=(u=t).getParam("emoticons_database","emojis","string"),u.getParam("emoticons_database_url",e+"/js/"+n+u.suffix+".js","string")),u=t.getParam("emoticons_database_id","tinymce.plugins.emoticons","string"),n=g(t,n,u),c=n,u=function(){return h(o,c)};(o=t).ui.registry.addButton("emoticons",{tooltip:"Emoticons",icon:"emoji",onAction:u}),o.ui.registry.addMenuItem("emoticons",{text:"Emoticons...",icon:"emoji",onAction:u}),i=n,(r=t).ui.registry.addAutocompleter("emoticons",{ch:":",columns:"auto",minChars:2,fetch:function(n,e){return i.waitForLoad().then(function(){var t=i.listAll();return d(t,n,w.some(e))})},onAction:function(t,n,e){r.selection.setRng(n),r.insertContent(e),t.hide()}}),(a=t).on("PreInit",function(){a.parser.addAttributeFilter("data-emoticon",function(t){!function(t){for(var n,e=0,o=t.length;e<o;e++)(n=t[e]).attr("data-mce-resize","false"),n.attr("data-mce-placeholder","1")}(t)})})})}();