!function(){"use strict";function m(t){return t=t.getParam("link_assume_external_targets",!1),Q(t)&&t?1:!X(t)||"http"!==t&&"https"!==t?0:t}function g(t){return t.getParam("default_link_target")}function d(t){return t.getParam("target_list",!0)}function h(t){return t.getParam("rel_list",[],"array")}function p(t){return t.getParam("allow_unsafe_link_target",!1,"boolean")}function f(){}function i(t){return function(){return t}}function t(){return nt}function s(t){for(var n=[],e=0,r=t.length;e<r;++e){if(!$(t[e]))throw new Error("Arr.flatten item "+e+" was not an array, input: "+t);it.apply(n,t[e])}return n}function v(t,n){for(var e=0;e<t.length;e++){var r=n(t[e],e);if(r.isSome())return r}return rt.none()}function l(t,n){return t?rt.some(n):rt.none()}function e(t){return X(t.value)?t.value:""}function n(n){return void 0===n&&(n=e),function(t){return rt.from(t).map(function(t){return at(t,n)})}}function y(t,u,a,l){return function(t){for(var n,e=ft(t),r=0,o=e.length;r<o;r++){var i=e[r];n=t[i],(u(n,i=i)?a:l)(n,i)}}(t),1}function r(t,n){return st.call(t,n)}function o(t){return t&&"a"===t.nodeName.toLowerCase()}function u(t){return o(t)&&!!gt(t)}function a(t,n){if(t.collapsed)return[];for(var t=t.cloneContents(),e=new mt(t.firstChild,t),r=[],o=t.firstChild;n(o)&&r.push(o),o=e.next(););return r}function k(t){return/^\w+:/i.test(t)}function x(t,n){var e=["noopener"],r=t?t.split(/\s+/):[],t=function(t){return t.filter(function(t){return-1===ut.inArray(e,t)})};return 0<(r=n?0<(n=t(n=r)).length?n.concat(e):e:t(r)).length?ut.trim(r.sort().join(" ")):""}function b(t,n){return n=n||t.selection.getNode(),dt(n)?t.dom.select("a[href]",n)[0]:t.dom.getParent(n,"a[href]")}function O(t,n){return(n?n.innerText||n.textContent:t.getContent({format:"text"})).replace(/\uFEFF/g,"")}function c(t){return 0<ut.grep(t,u).length}function w(t){var n=t.schema.getTextInlineElements();return 0===a(t.selection.getRng(),function(t){return 1===t.nodeType&&!o(t)&&!r(n,t.nodeName.toLowerCase())}).length}function C(t){return r=function(n,e){return t[e].each(function(t){n[e]=0<t.length?t:null}),n},o={href:t.href},function(t){for(var n=0,e=t.length;n<e;n++)o=r(o,t[n])}(["title","rel","class","target"]),o;var r,o}function N(u,a,l){var t,n,e,c=u.selection.getNode(),f=b(u,c),s=(t=u,n=C(l),n=ct({},n),0<h(t).length||!1!==p(t)||(e=x(n.rel,"_blank"===n.target),n.rel=e||null),rt.from(n.target).isNone()&&!1===d(t)&&(n.target=g(t)),n.href=(e=n.href,"http"!==(t=m(t))&&"https"!==t||k(e)?e:t+"://"+e),n);u.undoManager.transact(function(){var n,e,t,r,o,i;l.href===a.href&&a.attach(),f?(u.focus(),t=u,r=f,o=l.text,i=s,o.each(function(t){r.hasOwnProperty("innerText")?r.innerText=t:r.textContent=t}),t.dom.setAttribs(r,i),t.selection.select(r)):(n=u,i=l.text,e=s,dt(t=c)?pt(n,t,e):i.fold(function(){n.execCommand("mceInsertLink",!1,e)},function(t){n.insertContent(n.dom.createHTML("a",e,n.dom.encode(t)))}))})}function A(t,n,e){var r,o,i,u,a,l,c;t.hasPlugin("rtc",!0)?t.execCommand("createlink",!1,(r=e.class,o=e.href,i=e.rel,u=e.target,a=e.text,c=e.title,c={class:r.getOrNull(),href:o,rel:i.getOrNull(),target:u.getOrNull(),text:a.getOrNull(),title:c.getOrNull()},y(c,function(t,n){return!1==(F===t)},(l=c={},function(t,n){l[n]=t}),f),c)):N(t,n,e)}function P(t){var u;t.hasPlugin("rtc",!0)?t.execCommand("unlink"):(u=t).undoManager.transact(function(){var t,n,e,r,o,i=u.selection.getNode();dt(i)?ht(u,i):(o=(t=u).dom,e=(n=t.selection).getBookmark(),r=n.getRng().cloneRange(),i=o.getParent(r.startContainer,"a[href]",t.getBody()),o=o.getParent(r.endContainer,"a[href]",t.getBody()),i&&r.setStartBefore(i),o&&r.setEndAfter(o),n.setRng(r),t.execCommand("unlink"),n.moveToBookmark(e)),u.focus()})}function T(t,i){function u(t,n){var e,r,o=("link"===(o=n.name)?i.link:"anchor"===o?i.anchor:rt.none()).getOr([]);return e=a.text,n=n.name,o=o,n=t[n],r=0<e.length,void 0!==n?vt(n,o).map(function(t){return{url:{value:t.value,meta:{text:r?e:t.text,attach:f}},text:r?e:t.text}}):rt.none()}var a={text:t.text,title:t.title};return{onChange:function(t,n){var e,r,o=n.name;return"url"===o?(e=t(),r=e.url,r=l(a.text.length<=0,rt.from(r.meta.text).getOr(r.value)),e=e.url,e=l(a.title.length<=0,rt.from(e.meta.title).getOr("")),r.isSome()||e.isSome()?rt.some(ct(ct({},r.map(function(t){return{text:t}}).getOr({})),e.map(function(t){return{title:t}}).getOr({}))):rt.none()):(e=["anchor","link"],-1<ot.call(e,o)?u(t(),n):("text"!==o&&"title"!==o||(a[o]=t()[o]),rt.none()))}}}function S(t){var n=t.href;return 0<n.indexOf("@")&&-1===n.indexOf("/")&&-1===n.indexOf("mailto:")?rt.some({message:"The URL you entered seems to be an email address. Do you want to add the required mailto: prefix?",preprocess:function(t){return ct(ct({},t),{href:"mailto:"+n})}}):rt.none()}function _(t){return t=t.dom.select("a:not([href])"),0<(t=s(function(t,n){for(var e=t.length,r=new Array(e),o=0;o<e;o++){var i=t[o];r[o]=n(i,o)}return r}(t,function(t){t=t.name||t.id;return t?[{text:t,value:"#"+t}]:[]}))).length?rt.some([{text:"None",value:""}].concat(t)):rt.none()}function R(n){function e(t){return n.convertURL(t.value||t.url,"href")}var t=n.getParam("link_list");return new kt(function(n){X(t)?xt.send({url:t,success:function(t){return n(function(t){try{return rt.some(JSON.parse(t))}catch(t){return rt.none()}}(t))},error:function(t){return n(rt.none())}}):Y(t)?t(function(t){return n(rt.some(t))}):n(rt.from(t))}).then(function(t){return t.bind(lt.sanitizeWith(e)).map(function(t){return 0<t.length?[{text:"None",value:""}].concat(t):t})})}function D(t,n,e){return null!==(e=t.getAttrib(n,e))&&0<e.length?rt.some(e):rt.none()}function L(l,c){return R(l).then(function(t){var n,e,r,o,i,u,a=(n=c,e=(a=l).dom,r=w(a)?rt.some(O(a.selection,n)):rt.none(),o=n?rt.some(e.getAttrib(n,"href")):rt.none(),i=n?rt.from(e.getAttrib(n,"target")):rt.none(),u=D(e,n,"rel"),a=D(e,n,"class"),{url:o,text:r,title:D(e,n,"title"),target:i,rel:u,linkClass:a});return{anchor:a,catalogs:{targets:function(t){t=d(t);return $(t)?lt.sanitize(t).orThunk(function(){return rt.some(bt)}):!1===t?rt.none():rt.some(bt)}(l),rels:function(t,n){var e=h(t);if(0<e.length){var r=n.is("_blank");return(!1===p(t)?lt.sanitizeWith(function(t){return x(lt.getValue(t),r)}):lt.sanitize)(e)}return rt.none()}(l,a.target),classes:function(t){t=t.getParam("link_class_list",[],"array");return 0<t.length?lt.sanitize(t):rt.none()}(l),anchor:_(l),link:t},optNode:rt.from(c),flags:{titleEnabled:l.getParam("link_title",!0,"boolean")}}})}function E(f){var t,n=b(t=f);L(t,n).then(function(t){var l,c,n=function(t){var e=t.getData();if(!e.url.value)return P(l),void t.close();var u,a,r,o,n=function(n){return rt.from(e[n]).filter(function(t){return!c.anchor[n].is(t)})},n={href:e.url.value,text:n("text"),target:n("target"),rel:n("rel"),class:n("linkClass"),title:n("title")},i={href:e.url.value,attach:void 0!==e.url.meta&&e.url.meta.attach?e.url.meta.attach:function(){}};a=n,v([S,(r=m(u=l),o=u.getParam("link_default_protocol","http","string"),function(t){var n=t.href;return 1===r&&!k(n)||0===r&&/^\s*www(\.|\d\.)/i.test(n)?rt.some({message:"The URL you entered seems to be an external link. Do you want to add the required "+o+":// prefix?",preprocess:function(t){return ct(ct({},t),{href:o+"://"+n})}}):rt.none()})],function(t){return t(a)}).fold(function(){return kt.resolve(a)},function(i){return new kt(function(n){var e=u,t=i.message,r=function(t){n(t?i.preprocess(a):a)},o=e.selection.getRng();yt.setEditorTimeout(e,function(){e.windowManager.confirm(t,function(t){e.selection.setRng(o),r(t)})})})}).then(function(t){A(l,i,t)}),t.close()},e=l=f,r=(u=c=t).anchor.text.map(function(){return{name:"text",type:"input",label:"Text to display"}}).toArray(),o=u.flags.titleEnabled?[{name:"title",type:"input",label:"Title"}]:[],i=rt.from(g(e)),t=u.anchor,t={url:{value:e=t.url.getOr(""),meta:{original:{value:e}}},text:t.text.getOr(""),title:t.title.getOr(""),anchor:e,link:e,rel:t.rel.getOr(""),target:t.target.or(i).getOr(""),linkClass:t.linkClass.getOr("")},u=u.catalogs,a=T(t,u);return{title:"Insert/Edit Link",size:"normal",body:{type:"panel",items:s([[{name:"url",type:"urlinput",filetype:"file",label:"URL"}],r,o,function(t){for(var n=[],e=function(t){n.push(t)},r=0;r<t.length;r++)t[r].each(e);return n}([u.anchor.map(lt.createUi("anchor","Anchors")),u.rels.map(lt.createUi("rel","Rel")),u.targets.map(lt.createUi("target","Open link in...")),u.link.map(lt.createUi("link","Link list")),u.classes.map(lt.createUi("linkClass","Class"))])])},buttons:[{type:"cancel",name:"cancel",text:"Cancel"},{type:"submit",name:"save",text:"Save",primary:!0}],initialData:t,onChange:function(n,t){t=t.name;a.onChange(n.getData,{name:t}).each(function(t){n.setData(t)})},onSubmit:n}}).then(function(t){f.windowManager.open(t)})}function M(t,n){return t.dom.getParent(n,"a[href]")}function U(t){return M(t,t.selection.getStart())}function B(t,n){var e;n&&(e=gt(n),/^#/.test(e)?(e=t.$(e)).length&&t.selection.scrollIntoView(e[0],!0):function(t){var n=document.createElement("a");n.target="_blank",n.href=t,n.rel="noreferrer noopener";var t=document.createEvent("MouseEvents");t.initMouseEvent("click",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),n=n,t=t,document.body.appendChild(n),n.dispatchEvent(t),document.body.removeChild(n)}(n.href))}function q(t){return function(){E(t)}}function I(t){return function(){B(t,U(t))}}function K(t,n){return t.on("NodeChange",n),function(){return t.off("NodeChange",n)}}function z(n){return function(t){return K(n,function(){t.setActive(!n.mode.isReadOnly()&&null!==b(n,n.selection.getNode()))})}}function j(e){return function(t){function n(){return t.setDisabled(null===b(e,e.selection.getNode()))}return n(),K(e,n)}}function V(r){return function(n){function e(t){return c(t)||(t=r.selection.getRng(),0<a(t,u).length)}var t=r.dom.getParents(r.selection.getStart());return n.setDisabled(!e(t)),K(r,function(t){return n.setDisabled(!e(t.parents))})}}var F,W=tinymce.util.Tools.resolve("tinymce.PluginManager"),H=tinymce.util.Tools.resolve("tinymce.util.VK"),G=function(e){return function(t){return t=typeof(n=t),(null===n?"null":"object"==t&&(Array.prototype.isPrototypeOf(n)||n.constructor&&"Array"===n.constructor.name)?"array":"object"==t&&(String.prototype.isPrototypeOf(n)||n.constructor&&"String"===n.constructor.name)?"string":t)===e;var n}},J=function(n){return function(t){return typeof t===n}},X=G("string"),$=G("array"),Q=J("boolean"),Y=J("function"),Z=i(!1),tt=i(!(F=null)),nt={fold:function(t,n){return t()},is:Z,isSome:Z,isNone:tt,getOr:G=function(t){return t},getOrThunk:J=function(t){return t()},getOrDie:function(t){throw new Error(t||"error: getOrDie called on none.")},getOrNull:i(null),getOrUndefined:i(void 0),or:G,orThunk:J,map:t,each:f,bind:t,exists:Z,forall:tt,filter:t,equals:J=function(t){return t.isNone()},equals_:J,toArray:function(){return[]},toString:i("none()")},et=function(e){function t(){return o}function n(t){return t(e)}var r=i(e),o={fold:function(t,n){return n(e)},is:function(t){return e===t},isSome:tt,isNone:Z,getOr:r,getOrThunk:r,getOrDie:r,getOrNull:r,getOrUndefined:r,or:t,orThunk:t,map:function(t){return et(t(e))},each:function(t){t(e)},bind:n,exists:n,forall:n,filter:function(t){return t(e)?o:nt},toArray:function(){return[e]},toString:function(){return"some("+e+")"},equals:function(t){return t.is(e)},equals_:function(t,n){return t.fold(Z,function(t){return n(e,t)})}};return o},rt={some:et,none:t,from:function(t){return null==t?nt:et(t)}},ot=Array.prototype.indexOf,it=Array.prototype.push,ut=tinymce.util.Tools.resolve("tinymce.util.Tools"),at=function(t,r){var o=[];return ut.each(t,function(t){var n,e=X((n=t).text)?n.text:X(n.title)?n.title:"";void 0!==t.menu?(n=at(t.menu,r),o.push({text:e,items:n})):(t=r(t),o.push({text:e,value:t}))}),o},lt={sanitize:function(t){return n(e)(t)},sanitizeWith:n,createUi:function(n,e){return function(t){return{name:n,type:"listbox",label:e,items:t}}},getValue:e},ct=function(){return(ct=Object.assign||function(t){for(var n,e=1,r=arguments.length;e<r;e++)for(var o in n=arguments[e])Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o]);return t}).apply(this,arguments)},ft=Object.keys,st=Object.hasOwnProperty,mt=tinymce.util.Tools.resolve("tinymce.dom.TreeWalker"),gt=function(t){return t.getAttribute("data-mce-href")||t.getAttribute("href")},dt=function(t){return t&&"FIGURE"===t.nodeName&&/\bimage\b/i.test(t.className)},ht=function(t,n){var e=t.dom.select("img",n)[0];!e||(n=t.dom.getParents(e,"a[href]",n)[0])&&(n.parentNode.insertBefore(e,n),t.dom.remove(n))},pt=function(t,n,e){n=t.dom.select("img",n)[0];n&&(e=t.dom.create("a",e),n.parentNode.insertBefore(e,n),e.appendChild(n))},vt=function(e,t){return v(t,function(t){return r(n=n=t,"items")&&void 0!==n.items&&null!==n.items?vt(e,t.items):l(t.value===e,t);var n})},yt=tinymce.util.Tools.resolve("tinymce.util.Delay"),kt=tinymce.util.Tools.resolve("tinymce.util.Promise"),xt=tinymce.util.Tools.resolve("tinymce.util.XHR"),bt=[{text:"Current window",value:""},{text:"New window",value:"_blank"}];W.add("link",function(t){var n,e,r,i,o,u,a,l;(n=t).ui.registry.addToggleButton("link",{icon:"link",tooltip:"Insert/edit link",onAction:q(n),onSetup:z(n)}),n.ui.registry.addButton("openlink",{icon:"new-tab",tooltip:"Open link",onAction:I(n),onSetup:j(n)}),n.ui.registry.addButton("unlink",{icon:"unlink",tooltip:"Remove link",onAction:function(){return P(n)},onSetup:V(n)}),(e=t).ui.registry.addMenuItem("openlink",{text:"Open link",icon:"new-tab",onAction:I(e),onSetup:j(e)}),e.ui.registry.addMenuItem("link",{icon:"link",text:"Link...",shortcut:"Meta+K",onAction:q(e)}),e.ui.registry.addMenuItem("unlink",{icon:"unlink",text:"Remove link",onAction:function(){return P(e)},onSetup:V(e)}),(r=t).ui.registry.addContextMenu("link",{update:function(t){return c(r.dom.getParents(t,"a"))?"link unlink openlink":"link"}}),o=function(t){var n=i.selection.getNode();return t.setDisabled(!b(i,n)),function(){}},(i=t).ui.registry.addContextForm("quicklink",{launch:{type:"contextformtogglebutton",icon:"link",tooltip:"Link",onSetup:z(i)},label:"Link",predicate:function(t){return!!b(i,t)&&i.getParam("link_context_toolbar",!1,"boolean")},initValue:function(){var t=b(i);return t?gt(t):""},commands:[{type:"contextformtogglebutton",icon:"link",tooltip:"Link",primary:!0,onSetup:function(t){var n=i.selection.getNode();return t.setActive(!!b(i,n)),z(i)(t)},onAction:function(t){var n,e,r=b(i),o=t.getValue();r?i.undoManager.transact(function(){i.dom.setAttrib(r,"href",o),i.selection.collapse(!1),t.hide()}):(n={href:o,attach:function(){}},e=w(i)?rt.some(O(i.selection,r)).filter(function(t){return 0<t.length}).or(rt.from(o)):rt.none(),A(i,n,{href:o,text:e,title:rt.none(),rel:rt.none(),target:rt.none(),class:rt.none()}),t.hide())}},{type:"contextformbutton",icon:"unlink",tooltip:"Remove link",onSetup:o,onAction:function(t){P(i),t.hide()}},{type:"contextformbutton",icon:"new-tab",tooltip:"Open link",onSetup:o,onAction:function(t){I(i)(),t.hide()}}]}),(l=t).on("click",function(t){var n=M(l,t.target);n&&H.metaKeyPressed(t)&&(t.preventDefault(),B(l,n))}),l.on("keydown",function(t){var n=U(l);n&&13===t.keyCode&&!0===t.altKey&&!1===t.shiftKey&&!1===t.ctrlKey&&!1===t.metaKey&&(t.preventDefault(),B(l,n))}),(u=t).addCommand("mceLink",function(){u.getParam("link_quicklink",!1,"boolean")?u.fire("contexttoolbar-show",{toolbarKey:"quicklink"}):q(u)()}),(a=t).addShortcut("Meta+K","",function(){a.execCommand("mceLink")})})}();