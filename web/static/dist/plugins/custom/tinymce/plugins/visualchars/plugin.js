!function(){"use strict";function u(n){return function(){return n}}var n=tinymce.util.Tools.resolve("tinymce.PluginManager"),i=u(!1),c=u(!0),t=function(){return a},a={fold:function(n,t){return n()},is:i,isSome:i,isNone:c,getOr:r,getOrThunk:o,getOrDie:function(n){throw new Error(n||"error: getOrDie called on none.")},getOrNull:u(null),getOrUndefined:u(void 0),or:r,orThunk:o,map:t,each:function(){},bind:t,exists:i,forall:c,filter:t,equals:e,equals_:e,toArray:function(){return[]},toString:u("none()")};function e(n){return n.isNone()}function o(n){return n()}function r(n){return n}function s(n,t){for(var e=0,o=n.length;e<o;e++)t(n[e],e)}function f(n,t){for(var e=j(n),o=0,r=e.length;o<r;o++){var u=e[o];t(n[u],u)}}function l(n){return n.dom.nodeValue}function d(n,t,e){!function(n,t,e){if(!(B(e)||P(e)||_(e)))throw console.error("Invalid call to Attribute.set. Key ",t,":: Value ",e,":: Element ",n),new Error("Attribute value was not simple");n.setAttribute(t,e+"")}(n.dom,t,e)}function m(n,t){n.dom.removeAttribute(t)}function v(n,t){return void 0===(t=function(n,t){t=n.dom.getAttribute(t);return null===t?void 0:t}(n,t))||""===t?[]:t.split(" ")}function g(n){return void 0!==n.dom.classList}function h(n,t){return function(n,t,e){e=v(n,t).concat([e]);return d(n,t,e.join(" ")),!0}(n,"class",t)}function p(n,t){return o=t,0<(n=function(n,t){for(var e=[],o=0,r=n.length;o<r;o++){var u=n[o];t(u,o)&&e.push(u)}return e}(v(e=n,t="class"),function(n){return n!==o})).length?d(e,t,n.join(" ")):m(e,t),0;var e,o}function y(n){0===(g(n)?n.dom.classList:v(n,"class")).length&&m(n,"class")}function b(n){return'<span data-mce-bogus="1" class="mce-'+F[n]+'">'+n+"</span>"}function w(n){var t=l(n);return M(n)&&void 0!==t&&I.test(t)}function N(n){return"span"===n.nodeName.toLowerCase()&&n.classList.contains("mce-nbsp-wrap")}function T(u,n){n=z(H.fromDom(n),w),s(n,function(n){var t=n.dom.parentNode;if(N(t))t=H.fromDom(t),o=R,g(t)?t.dom.classList.add(o):h(t,o);else{for(var e,o=u.dom.encode(l(n)).replace(U,b),r=u.dom.create("div",null,o);e=r.lastChild;)u.dom.insertAfter(e,n.dom);u.dom.remove(n.dom)}})}function k(o,n){n=o.dom.select(K,n),s(n,function(n){var t,e;N(n)?(t=H.fromDom(n),e=R,g(t)?t.dom.classList.remove(e):p(t,e),y(t)):o.dom.remove(n,!0)})}function A(n){var t=n.getBody(),e=n.selection.getBookmark(),o=function(n,t){for(;n.parentNode;){if(n.parentNode===t)return n;n=n.parentNode}}(n.selection.getNode(),t);k(n,o=void 0!==o?o:t),T(n,o),n.selection.moveToBookmark(e)}function O(n,t){var e;e=n,o=t.get(),e.fire("VisualChars",{state:o});var o=n.getBody();(!0===t.get()?T:k)(n,o)}function C(n,t){n.addCommand("mceVisualChars",function(){!function(n,t){t.set(!t.get());var e=n.selection.getBookmark();O(n,t),n.selection.moveToBookmark(e)}(n,t)})}function S(e,o){return function(t){t.setActive(o.get());function n(n){return t.setActive(n.state)}return e.on("VisualChars",n),function(){return e.off("VisualChars",n)}}}var D,E,L,x=function(e){function n(){return r}function t(n){return n(e)}var o=u(e),r={fold:function(n,t){return t(e)},is:function(n){return e===n},isSome:c,isNone:i,getOr:o,getOrThunk:o,getOrDie:o,getOrNull:o,getOrUndefined:o,or:n,orThunk:n,map:function(n){return x(n(e))},each:function(n){n(e)},bind:t,exists:t,forall:t,filter:function(n){return n(e)?r:a},toArray:function(){return[e]},toString:function(){return"some("+e+")"},equals:function(n){return n.is(e)},equals_:function(n,t){return n.fold(i,function(n){return t(e,n)})}};return r},V=function(n){return null==n?a:x(n)},t=function(t){return function(n){return typeof n===t}},B=(D="string",function(n){return n=typeof(t=n),(null===t?"null":"object"==n&&(Array.prototype.isPrototypeOf(t)||t.constructor&&"Array"===t.constructor.name)?"array":"object"==n&&(String.prototype.isPrototypeOf(t)||t.constructor&&"String"===t.constructor.name)?"string":n)===D;var t}),P=t("boolean"),_=t("number"),j=Object.keys,M=("undefined"!=typeof window||Function("return this;")(),E=3,function(n){return n.dom.nodeType===E}),q=function(n){if(null==n)throw new Error("Node cannot be null or undefined");return{dom:n}},H={fromHtml:function(n,t){t=(t||document).createElement("div");if(t.innerHTML=n,!t.hasChildNodes()||1<t.childNodes.length)throw console.error("HTML does not have a single root node",n),new Error("HTML must have a single root node");return q(t.childNodes[0])},fromTag:function(n,t){n=(t||document).createElement(n);return q(n)},fromText:function(n,t){n=(t||document).createTextNode(n);return q(n)},fromDom:q,fromPoint:function(n,t,e){return V(n.dom.elementFromPoint(t,e)).map(q)}},F={" ":"nbsp","­":"shy"},t=function(n,t){var e="";return f(n,function(n,t){e+=t}),new RegExp("["+e+"]",t?"g":"")},I=t(F),U=t(F,!0),K=(L="",f(F,function(n){L&&(L+=","),L+="span.mce-"+n}),L),R="mce-nbsp",z=function(n,t){var e=[],n=function(n,t){for(var e=n.length,o=new Array(e),r=0;r<e;r++){var u=n[r];o[r]=t(u,r)}return o}(n.dom.childNodes,H.fromDom);return s(n,function(n){e=(e=t(n)?e.concat([n]):e).concat(z(n,t))}),e},G=tinymce.util.Tools.resolve("tinymce.util.Delay");n.add("visualchars",function(n){var t,e,o,r,u,i,c,a,s,f=(o=n.getParam("visualchars_default_state",!1),t=o,{get:function(){return t},set:function(n){t=n}});return C(n,f),o=f,(e=n).ui.registry.addToggleButton("visualchars",{tooltip:"Show invisible characters",icon:"visualchars",onAction:function(){return e.execCommand("mceVisualChars")},onSetup:S(e,o)}),e.ui.registry.addToggleMenuItem("visualchars",{text:"Show invisible characters",icon:"visualchars",onAction:function(){return e.execCommand("mceVisualChars")},onSetup:S(e,o)}),r=n,u=f,i=G.debounce(function(){A(r)},300),!1!==r.getParam("forced_root_block")&&r.on("keydown",function(n){!0===u.get()&&(13===n.keyCode?A(r):i())}),r.on("remove",i.stop),a=f,(c=n).on("init",function(){O(c,a)}),s=f,{isEnabled:function(){return s.get()}}})}();